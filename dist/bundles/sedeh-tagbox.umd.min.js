!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("@angular/core"),require("@sedeh/into-pipes"),require("@angular/common"),require("@sedeh/drag-enabled")):"function"==typeof define&&define.amd?define("@sedeh/tagbox",["exports","@angular/core","@sedeh/into-pipes","@angular/common","@sedeh/drag-enabled"],t):t((e.sedeh=e.sedeh||{},e.sedeh.tagbox={}),e.ng.core,e["into-pipes"],e.ng.common,e["drag-enabled"])}(this,function(e,o,t,n,i){"use strict";var r={disabled:1,appendOnDrop:2,prependOnDrop:3,swapOnDrop:4};r[r.disabled]="disabled",r[r.appendOnDrop]="appendOnDrop",r[r.prependOnDrop]="prependOnDrop",r[r.swapOnDrop]="swapOnDrop";var s={viewOnly:1,addOnly:2,removeOnly:4,addAndRemove:6,addRemoveModify:7};s[s.viewOnly]="viewOnly",s[s.addOnly]="addOnly",s[s.removeOnly]="removeOnly",s[s.addAndRemove]="addAndRemove",s[s.addRemoveModify]="addRemoveModify";var a={disabled:1,multiSelect:2,singleSelect:3};a[a.disabled]="disabled",a[a.multiSelect]="multiSelect",a[a.singleSelect]="singleSelect";var l=function(){function e(e,t){this.renderer=e,this.el=t,this._tags=[],this._selectedindex=[],this.onchange=new o.EventEmitter,this.onerror=new o.EventEmitter,this.onselect=new o.EventEmitter,this.beforeAction=function(e){return!0},this.placeholder="Add Tag"}return e.prototype.ngOnInit=function(){var t=this;this.selectedindex&&this.selectedindex instanceof String&&this.tags&&!(this.tags instanceof String)?(e=String(this.selectedindex)).split(",").map(function(e){t._selectedindex.push(parseInt(e))}):this._selectedindex=this.selectedindex?this.selectedindex:[];if(!this.tags||this.tags instanceof Array)this._tags=this.tags?this.tags:[];else{var e=String(this.tags);this._tags=e.split(this.delineateby?this.delineateby:",")}this.renderer.setElementAttribute(this.el.nativeElement,"role","list")},e.prototype.ngOnChanges=function(e){},e.prototype.itemSelectedAt=function(e){var t=this.selectionpolicy!==a.disabled;return!(this._selectedindex.indexOf(e)<0)&&t},e.prototype.itemSelectionClass=function(e){return this.itemSelectedAt(e)?"selected":e<0||this.selectionpolicy===a.disabled?"left-padded":""},e.prototype.isRemovable=function(){var e=this.editpolicy===s.addAndRemove;return(e=(e=(e=e||this.editpolicy===s.addRemoveModify)||this.editpolicy===s.removeOnly)&&(!this.mintags||this._tags.length>this.mintags))||this.onerror.emit("Unable to remove tag. Operation is not allowed."),e},e.prototype.isDuplicate=function(e){var t=!(this._tags.indexOf(e)<0);return t&&this.onerror.emit("Unable to perform operation. Resulting duplicate tags is not allowed."),t},e.prototype.allowedToaddItem=function(e){var t=this.editpolicy===s.addAndRemove;(t=(t=(t=(t=t||this.editpolicy===s.addRemoveModify)||this.editpolicy===s.addOnly)&&(!this.maxtags||this._tags.length<this.maxtags))&&!this.isDuplicate(e))&&this.maxtaglength&&(this._tags.join(this.delineateby?this.delineateby:",").length+e.length+1>=this.maxboxlength&&(t=!1,this.onerror.emit("Unable to add tag. Resulting content will exceed maxtaglength.")));return t},e.prototype.notifyChange=function(){this.tags=this.tags instanceof Array?this._tags:this._tags.join(this.delineateby?this.delineateby:","),this.selectedindex=this.selectedindex instanceof Array?this._selectedindex.length?this._selectedindex.join(","):"":this._selectedindex,this.onchange.emit({id:this.id,tags:this.tags,selecedIndex:this.selectedindex,formController:this.formController})},e.prototype.notifySelection=function(){this.selectedindex=this.selectedindex instanceof Array?this._selectedindex.length?this._selectedindex.join(","):"":this._selectedindex,this.onselect.emit({id:this.id,selecedIndex:this.selectedindex,formController:this.formController})},e.prototype.createDropRequest=function(e,t,n){return{request:"drop",action:e,source:{id:t.parent.id,name:t.name},destination:{id:n.parent.id,name:n.name}}},e.prototype.prependTagAt=function(e,t,n){var i=!1,o=t.name+" "+this._tags[e];return(!this.maxtaglength||this.maxtaglength&&t.name.length<=this.maxtaglength)&&this.beforeAction(this.createDropRequest("prepend",t,n))&&(this._tags[e]=o,i=!0),i},e.prototype.appendTagAt=function(e,t,n){var i=!1,o=this._tags[e]+" "+t.name;return(!this.maxtaglength||this.maxtaglength&&t.name.length<=this.maxtaglength)&&this.beforeAction(this.createDropRequest("append",t,n))&&(this._tags[e]=o,i=!0),i},e.prototype.removeTagWithName=function(e){if(this.isRemovable()&&this.beforeAction({request:"remove",item:e}))if(this._selectedindex instanceof Array){var t=this._tags.indexOf(e),n=this._selectedindex.indexOf(t);this._tags.splice(t,1),0<=n&&(this._selectedindex.splice(n,1),this.notifyChange())}else this._selectedindex=[]},e.prototype.addTagWithName=function(e){var t=this._tags.indexOf(e);this._selectedindex.indexOf(t);return!!(t<0&&e.length&&this.allowedToaddItem(e)&&this.beforeAction({request:"add",item:e}))&&(this._tags.push(e),this.notifyChange(),!0)},e.prototype.onTagRemove=function(e){this.removeTagWithName(e.name)},e.prototype.onTagAdd=function(e){this.addTagWithName(e.name)?(e.name="",e.click(null)):e.reset()},e.prototype.onTagChange=function(e){if(!this.isDuplicate(e.name)&&this.beforeAction({request:"change",item:e.originalName,to:e.name})){var t=this._tags.indexOf(e.originalName);this._tags[t]=e.name,e.init(),this.notifyChange()}else e.reset()},e.prototype.onTagDrop=function(e){var t=this._tags.indexOf(e.source.name),n=this._tags.indexOf(e.destination.name);if(this.dragpolicy===r.appendOnDrop)if(e.source.parent.id===e.destination.parent.id){if(this.appendTagAt(n,e.source,e.destination)){var i=this._selectedindex.indexOf(t);this._tags.splice(t,1),this._selectedindex.splice(i,1),this.notifyChange()}}else this.appendTagAt(n,e.source,e.destination)&&(this.notifyChange(),e.source.parent.removeTagWithName(e.source.name));else if(this.dragpolicy===r.prependOnDrop)if(e.source.parent.id===e.destination.parent.id){if(this.prependTagAt(n,e.source,e.destination)){i=this._selectedindex.indexOf(t);this._tags.splice(t,1),this._selectedindex.splice(i,1),this.notifyChange()}}else this.prependTagAt(n,e.source,e.destination)&&(this.notifyChange(),e.source.parent.removeTagWithName(e.source.name));this.dragpolicy===r.swapOnDrop&&this.beforeAction(this.createDropRequest("swap",e.source,e.destination))&&(e.source.parent.id===e.destination.parent.id?(this._tags[t]=this._tags.splice(n,1,this._tags[t])[0],this.notifyChange()):this.addTagWithName(e.source.name)&&(this.removeTagWithName(e.destination.name),e.source.parent.removeTagWithName(e.source.name)))},e.prototype.onTagSelect=function(e){if(this.selectionpolicy!==a.disabled&&(this.onTagFocus(e),this.beforeAction({request:"select",item:e.name})))if(this.selectionpolicy===a.singleSelect){for(var t=this.el.nativeElement.childNodes,n=0;n<t.length;n++)3!==t[n].nodeType&&8!==t[n].nodeType&&this.renderer.setElementClass(t[n],"selected",!1);if(0<=(i=this._tags.indexOf(e.name))){n=this._selectedindex.indexOf(i);this._selectedindex=n<0?(this.renderer.setElementClass(e.el.nativeElement,"selected",!0),[i]):(this.renderer.setElementClass(e.el.nativeElement,"selected",!1),[]),this.notifySelection()}}else{var i;if(0<=(i=this._tags.indexOf(e.name)))(n=this._selectedindex.indexOf(i))<0?(this.renderer.setElementClass(e.el.nativeElement,"selected",!0),this._selectedindex.push(i)):(this.renderer.setElementClass(e.el.nativeElement,"selected",!1),this._selectedindex.splice(n,1)),this.notifySelection()}},e.prototype.onTagFocus=function(e){if(this.selectionpolicy!==a.disabled){for(var t=this.el.nativeElement.childNodes,n=0;n<t.length;n++)3!==t[n].nodeType&&8!==t[n].nodeType&&this.renderer.setElementClass(t[n],"focused",!1);0<=this._tags.indexOf(e.name)&&this.renderer.setElementClass(e.el.nativeElement,"focused",!0)}},e.decorators=[{type:o.Component,args:[{selector:"tagbox",template:'\r\n<tag theme\r\n    *ngFor="let t of _tags; let i=index"\r\n    [class]="itemSelectionClass(i)"\r\n    [name]="t"\r\n    [parent]="this"\r\n    [removable]="isRemovable()"\r\n    [maxlength]="maxtaglength"\r\n    [format]="format"\r\n    [autocomplete]="autocomplete"\r\n    [attr.role]="\'listitem\'"\r\n    [selectionpolicy]="selectionpolicy"\r\n    [editpolicy]="editpolicy" \r\n    [dragpolicy]="dragpolicy"\r\n    (ondrop)="onTagDrop($event)"\r\n    (onchange)="onTagChange($event)"\r\n    (onadd)="onTagAdd($event)"\r\n    (onremove)="onTagRemove($event)"\r\n    (onselect)="onTagSelect($event)"\r\n    (onfocus)="onTagFocus($event)">\r\n</tag><tag theme\r\n    placeholder\r\n    tabindex="0"\r\n    name=""\r\n    [parent]="this"\r\n    [class]="itemSelectionClass(-1)"\r\n    [maxlength]="maxtaglength"\r\n    [placeholder]="placeholder"\r\n    [format]="format"\r\n    [autocomplete]="autocomplete"\r\n    [attr.role]="\'listitem\'"\r\n    [selectionpolicy]="selectionpolicy"\r\n    [editpolicy]="editpolicy" \r\n    [dragpolicy]="dragpolicy"\r\n    (ondrop)="onTagDrop($event)"\r\n    (onchange)="onTagChange($event)"\r\n    (onadd)="onTagAdd($event)"\r\n    (onremove)="onTagRemove($event)"\r\n    (onfocus)="onTagFocus($event)"></tag>\r\n',styles:[":host{background-color:#fff;border:1px solid #ced4da;box-sizing:border-box;display:inline-block;min-height:50px;padding:5px;width:100%;border-radius:5px;margin-bottom:5px}:host.alert{background-color:#ff9f9b;border-color:#880500}:host:focus{border-color:#0ba}:host:hover{background-color:#ddd}"]}]}],e.ctorParameters=function(){return[{type:o.Renderer},{type:o.ElementRef}]},e.propDecorators={onchange:[{type:o.Output,args:["onchange"]}],onerror:[{type:o.Output,args:["onerror"]}],onselect:[{type:o.Output,args:["onselect"]}],beforeAction:[{type:o.Input,args:["beforeAction"]}],id:[{type:o.Input,args:["id"]}],placeholder:[{type:o.Input,args:["placeholder"]}],maxboxlength:[{type:o.Input,args:["maxboxlength"]}],maxtaglength:[{type:o.Input,args:["maxtaglength"]}],maxtags:[{type:o.Input,args:["maxtags"]}],mintags:[{type:o.Input,args:["mintags"]}],formController:[{type:o.Input,args:["formController"]}],tags:[{type:o.Input,args:["tags"]}],selectedindex:[{type:o.Input,args:["selectedindex"]}],delineateby:[{type:o.Input,args:["delineateby"]}],format:[{type:o.Input,args:["format"]}],autocomplete:[{type:o.Input,args:["autocomplete"]}],selectionpolicy:[{type:o.Input,args:["selectionpolicy"]}],editpolicy:[{type:o.Input,args:["editpolicy"]}],dragpolicy:[{type:o.Input,args:["dragpolicy"]}]},e}(),d=function(){function e(){this.data={}}return e.prototype.setData=function(e,t){this.data[e]=t},e.prototype.getData=function(e){return this.data[e]},e.decorators=[{type:o.Injectable}],e.ctorParameters=function(){return[]},e}(),p=function(){function e(e,t,n,i){this.dataTransfer=e,this.into=t,this.el=n,this.renderer=i,this.selectedFiller=-1,this.onfocus=new o.EventEmitter,this.onchange=new o.EventEmitter,this.onselect=new o.EventEmitter,this.onremove=new o.EventEmitter,this.onadd=new o.EventEmitter,this.ondrop=new o.EventEmitter}return e.prototype.ngOnInit=function(){this.init(),this.el.nativeElement.draggable=this.dragpolicy!==r.disabled},e.prototype.dragStart=function(e){e.stopPropagation(),this.allowDrag()&&(e.dataTransfer.setData("source",this.name),this.dataTransfer.setData("source",this))},e.prototype.drag=function(e){},e.prototype.dragEnd=function(e){e.stopPropagation(),this.renderer.setElementClass(this.el.nativeElement,"drag-over",!1)},e.prototype.drop=function(e){e.preventDefault(),this.renderer.setElementClass(this.el.nativeElement,"drag-over",!1),this.ondrop.emit({source:this.dataTransfer.getData("source"),destination:this})},e.prototype.dragEnter=function(e){e.preventDefault(),this.allowDrop(e)?this.renderer.setElementClass(this.el.nativeElement,"drag-over",!0):this.renderer.setElementClass(this.el.nativeElement,"drag-over",!1)},e.prototype.dragLeave=function(e){e.preventDefault(),this.renderer.setElementClass(this.el.nativeElement,"drag-over",!1)},e.prototype.dragOver=function(e){this.allowDrop(e)?(e.preventDefault(),this.renderer.setElementClass(this.el.nativeElement,"drag-over",!0)):this.renderer.setElementClass(this.el.nativeElement,"drag-over",!1)},e.prototype.allowDrop=function(e){var t=this.dataTransfer.getData("source");return t&&t.name!=this.name&&this.name&&0<this.name.length&&(!t.format&&!this.format||t.format==this.format)},e.prototype.allowDrag=function(){return this.dragpolicy!==r.disabled&&this.name&&0<this.name.length},e.prototype.keyup=function(e){var t=this;if(e.target===this.el.nativeElement||this.editor&&e.target===this.editor.nativeElement)13===(n=e.which)?this.click(e):9===n&&this.editMode?setTimeout(function(){t.editMode=!1,t.originalName.length&&t.originalName!==t.name?t.onchange.emit(t):t.onadd.emit(t)},66):38===n?this.filler&&(0<=this.selectedFiller?this.selectedFiller--:this.selectedFiller=this.fillerList.length-1):40===n&&this.filler&&(this.selectedFiller<this.fillerList.length-1?this.selectedFiller++:this.selectedFiller=-1);else if(this.selector&&e.target===this.selector.nativeElement){13===(n=e.which)&&this.isSelectable()&&this.onselect.emit(this)}else if(this.holder&&e.target===this.holder.nativeElement){13===(n=e.which)&&(this.editMode=!0,setTimeout(function(){return t.editor.nativeElement.focus()},33))}else{var n;13===(n=e.which)&&this.remove()}},e.prototype.click=function(e){var t=this;this.selector&&e.target===this.selector.nativeElement?this.isSelectable()&&this.onselect.emit(this):this.isEditable()&&(this.editMode=!this.editMode,this.editMode?setTimeout(function(){t.filler&&(t.selectedFiller=-1,t.updateFillerList(t.name)),t.editor&&(t.editor.nativeElement.focus(),t.filler&&t.renderer.setElementClass(t.filler.nativeElement,"off",!1))},66):0<=this.selectedFiller&&(this.name=this.fillerList[this.selectedFiller]),this.originalName.length?(this.originalName!==this.name&&this.onchange.emit(this),this.editMode||setTimeout(function(){t.el.nativeElement.focus()},66)):this.onadd.emit(this))},e.prototype.focus=function(e){this.isSelectable()&&this.onfocus.emit(this)},e.prototype.isRemovable=function(){var e=this.editpolicy===s.addAndRemove;return e=(e=e||this.editpolicy===s.addRemoveModify)||this.editpolicy===s.removeOnly},e.prototype.isEditable=function(){return this.editpolicy===s.addRemoveModify},e.prototype.isDraggable=function(){return this.dragpolicy!==r.disabled},e.prototype.isSelectable=function(){return this.selectionpolicy!==a.disabled},e.prototype.select=function(){},e.prototype.tabout=function(e){var t=this;setTimeout(function(){t.name=t.selectedFiller<0?e.target.value:t.fillerList[t.selectedFiller],t.editMode=!1,t.originalName.length&&t.originalName!==t.name?t.onchange.emit(t):t.onadd.emit(t)},66)},e.prototype.edit=function(e){this.name=e.target.value,this.updateFillerList(this.name)},e.prototype.updateFillerList=function(t){t&&this.autocomplete instanceof Array&&t&&(this.fillerList=this.autocomplete.filter(function(e){return 0<=e.indexOf(t)}))},e.prototype.init=function(){this.originalName=this.name},e.prototype.reset=function(){this.name=this.originalName},e.prototype.remove=function(){this.isRemovable()&&this.onremove.emit(this)},e.prototype.formattedName=function(){var e=this.name;return this.format&&(e=this.into.transform(this.name,this.format)),e},e.decorators=[{type:o.Component,args:[{selector:"tag",template:'\r\n<span #selector\r\n    *ngIf="!editMode && removable && isSelectable()" \r\n    tabindex="0" \r\n    class="selection fa"\r\n    (click)="select()"></span>\r\n<input \r\n    *ngIf="editMode" \r\n    class="editor" \r\n    (blur)="tabout($event)"\r\n    (keyup)="edit($event)" \r\n    [value]="name"\r\n    [attr.maxlength]="maxlength"\r\n    [attr.placeholder]="placeholder" #editor/>\r\n<div class="autocomplete off" *ngIf="editMode && autocomplete" #filler>\r\n  <ul>\r\n      <li *ngFor="let x of fillerList; let i = index" \r\n        (click)="selectedFiller = i" \r\n        [class.selected]="selectedFiller === i"\r\n        [textContent]="x"></li>\r\n  </ul>\r\n</div>\r\n<span #holder\r\n    *ngIf="!editMode" \r\n    [tabindex]="isEditable() ? 0 : -1" \r\n    [innerHTML]="placeholder ? placeholder : formattedName()"></span>\r\n<span \r\n    *ngIf="!editMode && removable" \r\n    tabindex="0" \r\n    class="remove fa fa-times" \r\n    (click)="remove()"></span>\r\n<span \r\n    *ngIf="!removable" \r\n    class="placeholder fa fa-plus-circle"></span>',styles:[':host{cursor:pointer;color:#fdfdfd;margin:4px 2px;display:inline-block;background-color:#1f84ab;border:1px solid #015e85;border-radius:8px 20px 20px 8px;box-sizing:border-box;padding:3px 0;position:relative}:host ::ng-deep img{height:25px}:host.left-padded{padding-left:8px}:host.drag-over{background-color:#add8e6!important;cursor:move}:host[placeholder]{background-color:transparent;color:#000;border:0}:host[placeholder]:hover{background-color:#eee!important}:host[placeholder] .editor{color:#000}:host:hover{background-color:#027912!important;border-color:#024b0b!important}:host.focused{background-color:#027912!important;border-color:#024b0b!important}:host.selected:hover{background-color:#d6534e}:host.selected{background-color:#d6534e}:host.selected .selection.fa:before{content:"\\f00c"!important}:host .selection{background-color:transparent;float:left;margin-right:3px;padding:5px 3px;width:10px;height:10px;font-size:.8rem}:host .selection.fa:before{content:"\\f013"}:host .editor{background-color:transparent;overflow:unset;max-width:inherit;width:inherit;color:#fff;border:none}:host .placeholder{color:#888585;float:right;font-size:1rem;height:20px;line-height:20px;margin-left:5px;text-align:center;width:20px}:host .remove{float:right;font-size:.7rem;height:20px;width:20px;color:#fff;text-align:center;margin-left:5px;line-height:20px;font-weight:bolder}:host .holder{pointer-events:none;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}:host .autocomplete{position:absolute;top:26px;z-index:5}:host .autocomplete.off{display:none}:host .autocomplete ul{border:1px solid #024b0b;border-top:0;list-style:none inside;background-color:#027912;margin:0;max-height:150px;overflow-y:auto;padding:0}:host .autocomplete ul li{color:#fdfdfd;padding:5px;white-space:nowrap}:host .autocomplete ul li.selected{background-color:#d6534e}:host .autocomplete ul li:hover{background-color:#0446a8;color:#fff}']}]}],e.ctorParameters=function(){return[{type:d},{type:t.InToPipe},{type:o.ElementRef},{type:o.Renderer}]},e.propDecorators={onfocus:[{type:o.Output,args:["onfocus"]}],onchange:[{type:o.Output,args:["onchange"]}],onselect:[{type:o.Output,args:["onselect"]}],onremove:[{type:o.Output,args:["onremove"]}],onadd:[{type:o.Output,args:["onadd"]}],ondrop:[{type:o.Output,args:["ondrop"]}],format:[{type:o.Input,args:["format"]}],removable:[{type:o.Input,args:["removable"]}],maxlength:[{type:o.Input,args:["maxlength"]}],name:[{type:o.Input,args:["name"]}],placeholder:[{type:o.Input,args:["placeholder"]}],parent:[{type:o.Input,args:["parent"]}],autocomplete:[{type:o.Input,args:["autocomplete"]}],selectionpolicy:[{type:o.Input,args:["selectionpolicy"]}],editpolicy:[{type:o.Input,args:["editpolicy"]}],dragpolicy:[{type:o.Input,args:["dragpolicy"]}],editor:[{type:o.ViewChild,args:["editor"]}],selector:[{type:o.ViewChild,args:["selector"]}],holder:[{type:o.ViewChild,args:["holder"]}],filler:[{type:o.ViewChild,args:["filler"]}],dragStart:[{type:o.HostListener,args:["dragstart",["$event"]]}],drag:[{type:o.HostListener,args:["drag",["$event"]]}],dragEnd:[{type:o.HostListener,args:["dragend",["$event"]]}],drop:[{type:o.HostListener,args:["drop",["$event"]]}],dragEnter:[{type:o.HostListener,args:["dragenter",["$event"]]}],dragLeave:[{type:o.HostListener,args:["dragleave",["$event"]]}],dragOver:[{type:o.HostListener,args:["dragover",["$event"]]}],keyup:[{type:o.HostListener,args:["keyup",["$event"]]}],click:[{type:o.HostListener,args:["click",["$event"]]}],focus:[{type:o.HostListener,args:["focus",["$event"]]}]},e}(),c=function(){function e(){}return e.decorators=[{type:o.NgModule,args:[{imports:[n.CommonModule,t.IntoPipeModule,i.DragDropModule],declarations:[l,p],exports:[l],entryComponents:[],providers:[d],schemas:[o.CUSTOM_ELEMENTS_SCHEMA]}]}],e}();e.TagBoxComponent=l,e.DragDropPolicy=r,e.EditPolicy=s,e.Selectionpolicy=a,e.TagBoxModule=c,e.ɵa=p,e.ɵb=d,Object.defineProperty(e,"__esModule",{value:!0})});
//# sourceMappingURL=sedeh-tagbox.umd.min.js.map